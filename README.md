# 牛马音乐播放器 (NiuMa Music Player)

- 一个基于**Python**和**PyQt5**开发的**音乐播放器**，用**AI辅助**从**B站**搜索和下载音乐，并且有着**简洁**且**较为友好**的UI
- 当你厌倦了各种音乐软件的**广告、会员、付费歌曲**，还嫌把Bilibili当音乐播放器占用内存资源或者觉得歌单管理麻烦，那不妨试试这个项目
- 本项目纯工具，所有资源从B站获取，**请遵守B站的相关条款和协议**
- <mark>请务必仔细阅读【注意事项】和【常见问题解答】部分</mark>

## 功能特点

- **快速上手：** 只需要你有python，然后安装5个依赖库，即可运行
- **多播放列表支持：** 以txt格式保存播放列表，方便编辑、管理，可以在播放器中自由切换
- **智能添加歌曲：** 使用搜索功能，优先从本地下载目录中添加，否则通过AI智能搜索分析满足条件的B站视频，并下载其音频添加到列表中
- **友好的用户界面：** 支持点击按钮实现上一曲、下一曲、暂停、循环模式切换等基础功能；支持上下左右键实现上、下一曲，进度前进后退动能；高亮显示当前播放歌曲并支持双击歌曲切歌
- **结构简单透明，便于管理：** 所有信息只存在于播放列表和歌曲下载目录中，方便手动管理或者介入脚本智能管理，便于人工调整AI自动完成的结果中不满意的地方

## 安装&使用

### 1. 文件结构说明

```
niuma-music-player/
├── music_player.py               # 主程序文件
├── tools/                        # 工具模块目录
│   ├── search_music.py           # 音乐搜索模块
│   └── auto_download_bilibili.py # B站音乐下载模块
├── music_download/               # 下载的音乐存放目录 (自动创建)
├── MUSICLIST_列表1.txt          # 播放列表文件示例
└── MUSICLIST_列表2.txt          # 播放列表文件示例
```

### 2. 安装Python和依赖库

```bash
# 安装Python (如果尚未安装)
# 访问 https://www.python.org/downloads/ 下载并安装Python 3.6+

# 安装依赖库
pip install -r requirements.txt
```

### 3. 配置歌曲列表

播放列表文件必须遵循以下命名格式：`MUSICLIST_列表名称.txt`

文件内容格式：
- 每行一首歌曲
- 格式为：`歌曲名称--歌手名称` 或 `歌曲名称`（无歌手名）
- `--` 为分隔符，歌曲名称和歌手名称内避免出现
- 例如：
  ```
   雨过昔年--奇然
   烟雨行舟
   牵丝戏--银临_Aki阿杰
  ```

### 4. 运行程序

```bash
python music_player.py
```

## 播放器操作说明

### 播放器UI

1. 左上角**下拉菜单**切换播放列表（下拉点击当前播放列表可以重新加载）
2. 右上角**搜索框**输入关键词，格式为`歌曲名称--歌手名称` 或 `歌曲名称`（无歌手名），回车后如果本地有匹配的歌曲（同时满足歌曲歌手条件），则自动添加到当前播放列表中，否则通过AI辅助下载满足条件的歌曲（右下角状态栏显示下载情况），然后添加到当前播放列表中
3. 中间**列表框**显示当前列表的歌曲和歌手，高亮显示当前播放的歌曲，双击歌曲可以切歌
4. 下方**进度条**显示播放进度，可以点击对应位置跳转播放进度
5. 进度条下方**按钮**用于播放器的基础功能，从左到右依次为：上一曲、暂停/播放、下一曲、循环模式切换（顺序播放、单曲循环、随机播放）

### 快捷键
| 快捷键     | 功能       |
|-----------|------------|
| 空格键     | 播放/暂停   |
| 左箭头     | 后退5秒     |
| 右箭头     | 前进5秒     |
| 上箭头     | 上一曲      |
| 下箭头     | 下一曲      |

## 补充说明

### 1. 关于AI大模型配置

- (1)需要在`tools`目录下创建`search_music.py`和`auto_download_bilibili.py`正确配置AI大模型的api参数(包括api_url、api_key、model_name等)
- (2)代码里内置的是我买的10块钱的api测试用，别想着薅羊毛了，如果能用你就用一下，时间长了说不定哪天就不好使了

### 2. 关于tools目录下的两个模块
- (1) `search_music.py`和`auto_download_bilibili.py`也可单独使用，详见`tools`对应文件的`README`文档
- (2) `search_music.py`实现了给定歌名（歌手）从B站搜索相关视频，然后用AI找到最合适的结果，并返回BV号的功能；`auto_download_bilibili.py`实现了根据BV号下载音频文件，并可选择使用AI重命名的功能，所以你知道了原理也<mark>可以自己去智能搜索或者自己找视频根据BV号下载</mark>

### 3.关于使用细节（重要，重要，重要）
- (1) 如果你在下载歌曲时（无论是从列表导入显示需要下载，还是通过搜索框手动下载），如果指定了歌手名，那么就会**优先按照你给出的“歌曲名称--歌手名称”的格式命名**，否则，如果你没有指定歌手名，那么就会调用大模型来智能命名，但这样可能会出现歌曲名和列表中或者搜索的不一致（你打错了，或者AI没找到，下错了），所以请手动修改`music_download`目录下的歌曲名称以及`NAMELIST_列表名称.txt`文件中的歌曲名称，保证匹配
- (2) 如果有任何其他意外，也请<mark>手动修改`music_download`目录下的歌曲名称，和`NAMELIST_列表名称.txt`文件中的歌曲名称</mark>，只要匹配，那么程序就不会额外提示下载等操作导致文件结构变化
- (3) 项目需要<mark>使用`ffmpeg`来进行音频格式转换</mark>，如果系统中安装了`ffmpeg`，那么程序优先调用系统中的`ffmpeg`，如果没有，你可以安装或者下载编译好的二进制版本放到`tools`目录下的`bin`文件夹中，具体要求如下：
```
niuma-music-player/tools/
├── auto_download_bilibili.py
├── bin/
│   ├── windows/
│   │   ├── ffmpeg.exe
│   │   ├── ffprobe.exe
│   │   └── ffplay.exe
│   ├── macos/
│   │   ├── ffmpeg
│   │   ├── ffprobe
│   │   └── ffplay
│   └── linux/
│       ├── ffmpeg
│       ├── ffprobe
│       └── ffplay
└── other files...
```

- (4) 当你发现快捷键不好使时，确保窗口处于前台，然后**点击一下进度条和按钮之间的区域**就好了，不要选中任何按钮或者其他组件
- (5) 其他定制化的内容比如窗口大小，字体之类的可以在主程序中轻松修改，自己玩得开心就好

## 常见问题解答

1. **Q: 为什么有的歌曲每次加载列表都需要下载"?**  
   A: 可能是因为歌曲名称有错别字（例如"梦回还"写成"梦回环"），AI只能下载时通过错误的关键字会找到正确的结果；也可能是B站标题比较抽象，导致命名出现问题。总之当出现这种情况，请手动修改对应`NAMELIST`中的歌曲名称以及`music_download`目录下的歌曲名称。

2. **Q: 下载的音乐保存在哪里?**  
   A: 保存在程序所在目录的`music_download`子目录中。

3. **Q: 如何创建新的播放列表?**  
   A: 在程序目录下创建一个名为`MUSICLIST_列表名称.txt`的文本文件，然后按照上述格式添加歌曲。

4. **Q: 程序出现奇奇怪怪的问题?**  
   A: 请手动修改`music_download`目录下的歌曲名称，和`NAMELIST_列表名称.txt`文件中的歌曲名称，都正确且匹配则可以正常运行，重要的事情说三遍！
   
## 技术路线

1. **GUI框架**：使用PyQt5构建用户界面
2. **音频播放**：使用Qt的QMediaPlayer组件播放，使用mutagen库获取音频时长
3. **多线程**：使用QThread处理音乐下载，避免UI卡顿
4. **音乐搜索&智能选择**：
   - 通过关键词搜索B站获取相关视频列表
   - 使用LLM智能选择最佳匹配视频
   - 使用`yt-dlp`下载音频文件，使用`ffmpeg`调整格式为mp3
   - 可以通过LLM自动重命名
   - 将新歌曲添加到当前播放列表文件
5. **事件处理**：使用Qt信号槽机制处理用户交互和播放事件
